<!DOCTYPE html>
<html lang="en" ng-app="cricketApp" ng-controller="ScoringController as ctrl">
<head>
  <meta charset="UTF-8">
  <title>Cricket Scorer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <style>
    .btn-circle { width: 48px; height: 48px; border-radius: 50%; padding: 0; font-size: 1rem; line-height: 44px; }
    .scorebox { font-size: 1.2rem; }
    .over-box { border: 1px solid #ccc; padding: 5px 10px; border-radius: 6px; }
    .highlight-striker { font-weight: bold; color: green; }
  </style>
</head>
<body class="bg-light">

<div class="container py-3">
  <!-- Match Title and Score -->
  <div class="bg-success text-white p-3 rounded mb-3">
    <h5>{{ctrl.match.title}}</h5>
    <div class="d-flex justify-content-between">
      <div><strong>{{ctrl.match.team1}} - {{ctrl.match.score}} ({{ctrl.match.overs}})</strong></div>
      <div>CRR: {{ctrl.match.crr}}</div>
    </div>
  </div>

  <!-- Players Table -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead>
        <tr><th>Batsman</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>SR</th></tr>
      </thead>
      <tbody>
        <tr ng-repeat="b in ctrl.batsmen">
          <td ng-class="{'highlight-striker': b.striker}">{{b.name}}{{b.striker ? '*' : ''}}</td>
          <td>{{b.runs}}</td>
          <td>{{b.balls}}</td>
          <td>{{b.fours}}</td>
          <td>{{b.sixes}}</td>
          <td>{{b.sr}}</td>
        </tr>
      </tbody>
    </table>

    <table class="table table-bordered align-middle text-center mt-2">
      <thead>
        <tr><th>Bowler</th><th>O</th><th>M</th><th>R</th><th>W</th><th>ER</th></tr>
      </thead>
      <tbody>
        <tr ng-repeat="bowler in ctrl.bowlers">
          <td>{{bowler.name}}</td>
          <td>{{bowler.overs}}</td>
          <td>{{bowler.maidens}}</td>
          <td>{{bowler.runs}}</td>
          <td>{{bowler.wickets}}</td>
          <td>{{bowler.er}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- This Over Display -->
  <div class="mb-2">
    <strong>This over:</strong>
    <span class="over-box me-1" ng-repeat="ball in ctrl.currentOver">{{ball}}</span>
  </div>

  <!-- Extras -->
  <div class="mb-2 d-flex flex-wrap gap-3">
    <div class="form-check"><input class="form-check-input" type="checkbox" ng-model="ctrl.extras.wide"> Wide</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" ng-model="ctrl.extras.noBall"> No Ball</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" ng-model="ctrl.extras.byes"> Byes</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" ng-model="ctrl.extras.legByes"> Leg Byes</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" ng-model="ctrl.extras.wicket"> Wicket</div>
  </div>

  <!-- Run Buttons -->
  <div class="d-flex flex-wrap gap-2 justify-content-start mb-3">
    <button ng-click="ctrl.scoreRun(0)" class="btn btn-secondary btn-circle">0</button>
    <button ng-click="ctrl.scoreRun(1)" class="btn btn-secondary btn-circle">1</button>
    <button ng-click="ctrl.scoreRun(2)" class="btn btn-secondary btn-circle">2</button>
    <button ng-click="ctrl.scoreRun(3)" class="btn btn-secondary btn-circle">3</button>
    <button ng-click="ctrl.scoreRun(4)" class="btn btn-success btn-circle">4</button>
    <button ng-click="ctrl.scoreRun(5)" class="btn btn-secondary btn-circle">5</button>
    <button ng-click="ctrl.scoreRun(6)" class="btn btn-danger btn-circle">6</button>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <button class="btn btn-outline-dark" ng-click="ctrl.undo()">Undo</button>
    <button class="btn btn-outline-danger" ng-click="ctrl.endFirstInnings()">End 1st Innings</button>
    <button class="btn btn-outline-success" onclick="window.location.href='match_summary.html'">Summary</button>
  </div>
</div>

<!-- End Innings Modal -->
<div class="modal fade" id="endInningsModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm End of Innings</h5>
      </div>
      <div class="modal-body">
        Are you sure you want to end the 1st innings?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" ng-click="ctrl.confirmEndInnings()">Yes, End Innings</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  const app = angular.module("cricketApp", []);
  app.controller("ScoringController", function($scope) {
    const ctrl = this;

    ctrl.match = {
      title: "Local League Match",
      team1: "Team A",
      score: "0/0",
      overs: "0.0",
      crr: "0.00"
    };

    ctrl.batsmen = [];
    ctrl.bowlers = [];
    ctrl.currentOver = [];
    ctrl.extras = {
      wide: false,
      noBall: false,
      byes: false,
      legByes: false,
      wicket: false
    };

    ctrl.scoreRun = function(runs) {
      const event = {
        ball: runs,
        wicket: ctrl.extras.wicket,
        extras: {
          wide: ctrl.extras.wide,
          noBall: ctrl.extras.noBall,
          byes: ctrl.extras.byes,
          legByes: ctrl.extras.legByes
        }
      };

      import('./js/scoring_logic.js').then(mod => mod.handleBall(event));
      ctrl.extras = {}; // Reset all checkboxes
    };

    ctrl.undo = function() {
      import('./js/scoring_logic.js').then(mod => mod.undoLastBall());
    };

    ctrl.endFirstInnings = function() {
      const modal = new bootstrap.Modal(document.getElementById('endInningsModal'));
      modal.show();
    };

    ctrl.confirmEndInnings = function() {
      window.location.href = 'start_next_innings.html';
    };
  });
</script>

<script>
  import('./js/ui_manager.js').then(mod => mod.updateUI());
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
